(()=>{var i=class extends HTMLElement{constructor(){super(),this.store=window.themeStore,this.keys=window.themeKeys,this.defaults={light:this.dataset.light,dark:this.dataset.dark},this.setTheme(this.getTheme()),this.addEventListener("click",this),this.addEventListener("change",this),document.addEventListener("keyup",this),this.styleStore="cknCustom",this.customSheet=new CSSStyleSheet}getPreferredScheme(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}setTheme(e){(!e||this.keys.includes(e)===!1)&&(e=""),document.documentElement.style.setProperty("--anim-f","0"),e?(document.documentElement.setAttribute("data-theme",e),localStorage.setItem(this.store,e)):(document.documentElement.removeAttribute("data-theme"),localStorage.removeItem(this.store)),requestAnimationFrame(()=>{setTimeout(()=>document.documentElement.style.removeProperty("--anim-f"))}),document.querySelectorAll("[data-theme-set]").forEach(function(t){t.setAttribute("aria-pressed",(t.getAttribute("data-theme-set")===e).toString())})}getTheme(){let e=localStorage.getItem(this.store);if(!e)return!1;if(this.keys.includes(e)===!1){let t=this.getPreferredScheme();return this.defaults[t]}return e}updateCustomThemeStyles(){let e=document.getElementById("theme-custom-form"),t=Object.fromEntries(new FormData(e));this.customSheet.replaceSync(`:root[data-theme="custom"] {
			${Object.entries(t).map(([o,s])=>`--${o}: ${s};`).join(`
`)}
			--header-bg-color: var(--C-surface);
		}`),document.adoptedStyleSheets=[this.customSheet],window.localStorage.setItem(this.styleStore,JSON.stringify(t))}connectedCallback(){let e=JSON.parse(window.localStorage.getItem(this.styleStore)||null),t=document.getElementById("theme-custom-form");if(e)Array.from(t.querySelectorAll("[name]")).forEach(o=>{let s=o.getAttribute("name"),a=o.getAttribute("type")||null,r=e[s];a==="radio"?o.checked=o.value===r:o.value=r});else{let s=this.getPreferredScheme()==="dark",a={canvas:s?"#001111":"#eeffff",surface:s?"#003333":"#cccccc",text:s?"#ffffff":"#000000",heading:s?"#ddffff":"#003333",accent:s?"#00ffff":"#550000"};Array.from(t.querySelectorAll('input[type="color"][data-color-key]')).forEach(r=>{r.value=a[r.getAttribute("data-color-key")]}),Array.from(t.querySelectorAll("[data-default]")).forEach(r=>{let l=r.closest("select"),c=r.closest('input[type="radio"]');l?l.value=r.value:c&&(c.checked=!0,console.log(c))})}this.updateCustomThemeStyles()}handleEvent(e){if(e.type==="click"){let t=e.target.closest("[data-theme-custom-action]"),o=e.target.closest("[data-theme-set]");if(t){let s=document.getElementById("theme-custom-controls"),a=t.getAttribute("data-theme-custom-action");a==="open"?(s.showModal(),this.updateCustomThemeStyles()):a==="close"?s.close():a==="apply"&&(this.updateCustomThemeStyles(),s.close())}else if(o){let s=o.getAttribute("aria-pressed")==="true";this.setTheme(s?!1:o.getAttribute("data-theme-set"))}}if(e.type==="keyup"){if(e.key==="Escape"){let t=document.querySelector(`[aria-controls=${this.id}]`);t&&t.getAttribute("aria-pressed")==="true"&&(t.setAttribute("aria-pressed","false"),t.focus())}else if(e.key>=0&&e.key<=this.keys.length&&!e.target?.closest?.("input")){let t=parseInt(e.key,10);this.querySelectorAll("[data-theme-set]")[t]?.click()}}e.type==="change"&&this.updateCustomThemeStyles()}};customElements.define("theme-picker",i);})();
